define("js/app/stigmod",["../lib/jquery","../lib/d3.v3","../lib/bootstrap"],function(require,exports,module){function dump_obj(a){var b="";for(var c in a)b=b+"\n "+c+": "+a[c];alert(b)}function addElemInModel(a,b,c){for(var d=(b.length,a[b.pop()]);0!=b.length;)d=d[b.pop()];d[c[0]]=c[1]}function modifyElemInModel(a,b,c,d){if(c!==d){for(var e=(b.length,a[b.pop()]);0!=b.length;)e=e[b.pop()];e[d]=e[c],delete e[c]}}function removeElemInModel(a,b,c){for(var d=(b.length,a[b.pop()]);0!=b.length;)d=d[b.pop()];delete d[c]}function getElemInModel(a,b){for(var c=(b.length,a[b.pop()]);0!=b.length;)c=c[b.pop()];return c}function addClass(a,b){addElemInModel(a,[0],[b,[{},{order:[]}]])}function addAttribute(a,b,c){addElemInModel(a,[0,b,0],[c,[{}]])}function addPropertyOfA(a,b,c,d){addElemInModel(a,[0,c,0,b,0],d)}function addRelationGroup(a,b){addElemInModel(a,[1],[b,[{},{order:[]}]])}function addRelation(a,b,c){addElemInModel(a,[0,b,1],[c,[{}]])}function addPropertyOfR(a,b,c,d){addElemInModel(a,[0,c,0,b,1],d)}function modifyClass(a,b,c){modifyElemInModel(a,[0],b,c)}function modifyAttribute(a,b,c,d){modifyElemInModel(a,[0,b,0],c,d);var e=a[0][b][1].order;e.splice(e.indexOf(c),1,d)}function modifyPropertyOfA(a,b,c,d,e){modifyElemInModel(a,[0,c,0,b,0],d,e)}function modifyRelationGroup(a,b,c){modifyElemInModel(a,[1],b,c)}function modifyRelation(a,b,c,d){modifyElemInModel(a,[0,b,1],c,d)}function modifyPropertyOfR(a,b,c,d,e){modifyElemInModel(a,[0,c,0,b,1],d,e)}function getProperty(a,b){return getElemInModel(a,[0,b,0,stateOfPage["class"],stateOfPage.flagCRG])}function elemExists(a,b,c){var d=null;switch(a){case 0:d=getElemInModel(model,[0]);break;case 1:d=getElemInModel(model,[1]);break;case 2:d=getElemInModel(model,[0,c,0])}return void 0!==d[b]}function getHtmlCompo(a){var b=null;return $.ajax({type:"GET",url:"/components/"+a,dataType:"html",async:!1,success:function(a){b=a},error:function(){alert('Sorry, The requested page "'+a+'" could not be found.')}}),b}function modifyLeftAndJump(a,b){fillLeft(a),$(document).find("#stigmod-pg-workspace #stigmod-nav-left-scroll .panel .list-group span[stigmod-nav-left-tag="+b+"]").trigger("click")}function modifyLeft(a,b){fillLeft(a);var c=$(document).find("#stigmod-pg-workspace #stigmod-nav-left-scroll .panel .list-group span[stigmod-nav-left-tag="+b+"]").parent();c.closest("#stigmod-nav-left-scroll").find(".list-group-item").removeClass("active"),c.addClass("active")}function refreshMiddelPanelTitle(a){var b=$("#stigmod-cont-right .panel");b.each(function(){var b=$(this).find(".panel-title > div.row > div:nth-child(2)"),c=getProperty(a,$(this).attr("stigmod-attrel-name")),d="";if(0===stateOfPage.flagCRG){if(void 0!==c.visibility){var e="";switch(c.visibility){case"public":e="+";break;case"private":e="-";break;case"protected":e="#";break;case"package":e="~"}d=d+e+" "}void 0!==c.name&&(d=d+c.name+" "),void 0!==c.type&&(d=d+": "+c.type+" "),void 0!==c.multiplicity&&(d=d+"["+c.multiplicity+"] "),void 0!==c["default"]&&(d=d+"= "+c["default"]+" "),b.text(d)}else{var f=c["class"][0],g=c["class"][1],h=c.type[1];switch(h="("+h+")",c.type[0]){case"Generalization":h=" ◁—"+h+"—— ";break;case"Composition":h=" ◆—"+h+"—— ";break;case"Aggregation":h=" ◇—"+h+"—— ";break;case"Association":h=" ——"+h+"—— "}void 0!==c.multiplicity&&(f=f+" ["+c.multiplicity[0]+"] ",g=" ["+c.multiplicity[1]+"] "+g),b.empty(),b.append("<span>"+f+"</span>"),b.append("<span>"+h+"</span>").find("span:last-child").css({"font-family":"Lucida Console"}),b.append("<span>"+g+"</span>")}})}function insertMiddle(a,b,c){var d=null,e=null,f=$("#stigmod-cont-right .panel "+(0===stateOfPage.flagCRG?".stigmod-attr-cont-middle-title":".stigmod-rel-cont-middle-title"));if(0===f.length)e=0;else{var g=-1;f.each(function(){var a=$(this).attr("data-target");a=parseInt(a.substr("#collapse".length)),a>g&&(g=a)}),e=g+1}d="@"===stateOfPage.posAddAtt?$("#stigmod-cont-right .list-group").before(0===stateOfPage.flagCRG?componentMiddleAttribute:componentMiddleRelation).prev():0===stateOfPage.dirAddAtt?$("#stigmod-cont-right .panel[stigmod-attrel-name="+stateOfPage.posAddAtt+"]").before(0===stateOfPage.flagCRG?componentMiddleAttribute:componentMiddleRelation).prev():$("#stigmod-cont-right .panel[stigmod-attrel-name="+stateOfPage.posAddAtt+"]").after(0===stateOfPage.flagCRG?componentMiddleAttribute:componentMiddleRelation).next(),d.attr({"stigmod-attrel-name":b});var h=(d.find(0===stateOfPage.flagCRG?".stigmod-attr-cont-middle-title":".stigmod-rel-cont-middle-title").attr({"data-target":"#collapse"+e}),d.find(".panel-collapse").attr({id:"collapse"+e}));for(var i in a[stateOfPage.flagCRG][stateOfPage["class"]][0][b][0])if(0===stateOfPage.flagCRG){var j=h.find(".stigmod-attr-prop-"+i).show();j.find("td:nth-child(2) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b][0][i])}else{var j=h.find(".stigmod-rel-prop-"+i).show();j.find("td:nth-child(2) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b][0][i][0]),j.find("td:nth-child(3) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b][0][i][1])}refreshMiddelPanelTitle(a),c?d.trigger("click"):(d.trigger("click"),setTimeout(function(){d.find(0===stateOfPage.flagCRG?".stigmod-attr-cont-middle-title":".stigmod-rel-cont-middle-title").trigger("click")},10))}function removeMiddle(a,b){$("#stigmod-cont-right .panel[stigmod-attrel-name="+b+"]").remove()}function fillLeft(a){var b=$("#stigmod-pg-workspace #stigmod-nav-left-scroll .panel:first-child .list-group").empty(),c=[];for(var d in a[0])c.push(d);c.sort();for(var e in c)b.append(componentLeftClass),b.find("a:last-child > span:first-child").text(c[e]).attr("stigmod-nav-left-tag",c[e]);b=$("#stigmod-pg-workspace #stigmod-nav-left-scroll .panel:last-child .list-group").empty();var f=[];for(var g in a[1])f.push(g);f.sort();for(var e in f)b.append(componentLeftRelationGroup),b.find("a:last-child > span:first-child").text(f[e]).attr("stigmod-nav-left-tag",f[e])}function fillMiddleBlank(){$("#stigmod-cont-right-scroll").empty()}function fillMiddleBasic(){var a=$("#stigmod-cont-right-scroll");a.empty(),a.append(0===stateOfPage.flagCRG?componentMiddleAttributeBasic:componentMiddleRelationBasic)}function fillMiddle(a){fillMiddleBasic(),$("#stigmod-cont-right-scroll #stigmod-classname > span:nth-child(2)").text(stateOfPage["class"]),$("#stigmod-cont-right .panel").remove();var b=a[stateOfPage.flagCRG][stateOfPage["class"]][1].order;for(var c in b){var d=$("#stigmod-cont-right .list-group").before(0===stateOfPage.flagCRG?componentMiddleAttribute:componentMiddleRelation).prev();d.attr({"stigmod-attrel-name":b[c]});var e=(d.find(0===stateOfPage.flagCRG?".stigmod-attr-cont-middle-title":".stigmod-rel-cont-middle-title").attr({"data-target":"#collapse"+c}),d.find(".panel-collapse").attr({id:"collapse"+c}));for(var f in a[stateOfPage.flagCRG][stateOfPage["class"]][0][b[c]][0]){var g=null;0===stateOfPage.flagCRG?(g=e.find(".stigmod-attr-prop-"+f).show(),g.find("td:nth-child(2) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b[c]][0][f])):(g=e.find(".stigmod-rel-prop-"+f).show(),g.find("td:nth-child(2) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b[c]][0][f][0]),g.find("td:nth-child(3) > .stigmod-clickedit-disp").text(a[stateOfPage.flagCRG][stateOfPage["class"]][0][b[c]][0][f][1]))}}refreshMiddelPanelTitle(a)}function getInputCheckResult(a,b){function c(a){var c=/\.\./;if(c.test(a)){var d=b.split("..");if("*"!==d[1])return parseInt(d[0])<parseInt(d[1])}return!0}var d=null;switch(a){case"class-add":return d=/^[A-Z][A-Za-z]*$/,d.test(b)?elemExists(0,b)?"Class already exists.":"valid":"Valid Format: "+d.toString();case"class-modify":return d=/^[A-Z][A-Za-z]*$/,d.test(b)?stateOfPage["class"]!==b&&elemExists(0,b)?"Class already exists.":"valid":"Valid Format: "+d.toString();case"relationgroup-add":return elemExists(0,b)?"valid":"Class does not exist.";case"attribute-add":return d=/^[a-z][A-Za-z]*$/,d.test(b)?elemExists(2,b,stateOfPage["class"])?"Attribute name already exists.":"valid":"Valid Format: "+d.toString();case"attribute-modify":return d=/^[a-z][A-Za-z]*$/,d.test(b)?stateOfPage.attribute!==b&&elemExists(2,b,stateOfPage["class"])?"Attribute name already exists.":"valid":"Valid Format: "+d.toString();case"type-add":case"type-modify":return d=/^(int|float|string|boolean)$/,d.test(b)||elemExists(0,b)?"valid":"Valid Type: A class or built-in type (int|float|string|boolean).";case"multiplicity-add":case"multiplicity-modify":return d=/^(\*|\d+(\.\.(\d+|\*))?)$/,d.test(b)?c(b)?"valid":"The second number should be bigger.":"Valid Format: "+d.toString();case"visibility-add":case"visibility-modify":return d=/^(public|private|protected|package)$/,d.test(b)?"valid":"Valid Format: "+d.toString();case"relation-add":case"relation-modify":return d=/^(|[a-z][A-Za-z]*)$/,d.test(b)?"valid":"Valid Type: "+d.toString();case"role-add":case"role-modify":return d=/^[a-z][A-Za-z]*$/,d.test(b)?"valid":"Valid Type: "+d.toString();case"default-add":case"default-modify":case"constraint-add":case"constraint-modify":case"subsets-add":case"subsets-modify":case"redefines-add":case"redefines-modify":case"end-add":case"end-modify":return d=/^.+$/,d.test(b)?"valid":"Input can not be void.";default:return"valid"}}function checkInput(a){var b=a.attr("stigmod-inputcheck");if(void 0!==b){var c=a.val(),d=getInputCheckResult(b,c),e=null;switch(b){case"class-modify":e="bottom";break;default:e="top"}return"valid"!==d?(a.tooltip("destroy"),a.tooltip({animation:!1,title:d,placement:e,trigger:"manual"}),a.tooltip("show"),!1):(a.tooltip("destroy"),!0)}}function checkInputs(a){for(var b=a.size(),c=!0,d=0;b>d;++d)c=checkInput(a.eq(d))&&c;return c}function focusOnInputIn(a){a.find("input[type=text]").eq(0).focus()}var $=require("../lib/jquery"),d3=require("../lib/d3.v3");require("../lib/bootstrap");var model=[{Course:[{code:[{name:"code",type:"string",visibility:"public"}],credit:[{name:"credit",type:"float",visibility:"private"}],availability:[{name:"availability",type:"CourseAvailability",visibility:"protected",readOnly:"True"}]},{order:["code","credit","availability"]}],CourseActivity:[{startTime:[{name:"startTime",type:"Time"}],endTime:[{name:"endTime",type:"Time"}]},{order:["startTime","endTime"]}],Student:[{code:[{name:"code",type:"string"}],enrollmentDate:[{name:"enrollmentDate",type:"Date"}]},{order:["code","enrollmentDate"]}],Teacher:[{facultyCode:[{name:"facultyCode",type:"string"}],title:[{name:"title",type:"Title"}]},{order:["facultyCode","title"]}],User:[{email:[{name:"email",type:"string"}],username:[{name:"username",type:"string"}],photo:[{name:"photo",type:"Image"}],password:[{name:"password",type:"string"}],birthDate:[{name:"birthDate",type:"Date"}],name:[{name:"name",type:"string"}]},{order:["username","password","name","birthDate","email","photo"]}],Department:[{name:[{name:"name",type:"string"}],code:[{name:"code",type:"string"}],requiredCreditOfM:[{name:"requiredCreditOfM",type:"RequiredCredit"}],requiredCreditOfB:[{name:"requiredCreditOfB",type:"RequiredCredit"}],requiredCreditOfD:[{name:"requiredCreditOfD",type:"RequiredCredit"}]},{order:["name","code","requiredCreditOfB","requiredCreditOfM","requiredCreditOfD"]}]},{"Course-CourseActivity":[{tempid1419265720151:[{type:["Composition","possess"],role:["whole","part"],"class":["Course","CourseActivity"],multiplicity:["1","*"]}]},{order:["tempid1419265720151"]}],"Course-Student":[{tempid1419597303227:[{type:["Association",""],"class":["Course","Student"],multiplicity:["0..*","*"]}]},{order:["tempid1419597303227"]}],"Course-Teacher":[{tempid1419597378206:[{type:["Association",""],"class":["Course","Teacher"],multiplicity:["0..*","1..*"]}]},{order:["tempid1419597378206"]}],"Student-User":[{tempid1419597406622:[{type:["Generalization",""],role:["father","child"],"class":["User","Student"],multiplicity:["1","1"]}]},{order:["tempid1419597406622"]}],"Teacher-User":[{tempid1419597442832:[{type:["Generalization",""],role:["father","child"],"class":["User","Teacher"],multiplicity:["1","1"]}]},{order:["tempid1419597442832"]}],"Course-Department":[{tempid1419597640012:[{type:["Association",""],"class":["Course","Department"],multiplicity:["*","1"]}]},{order:["tempid1419597640012"]}],"Department-Student":[{tempid1419597702615:[{type:["Association",""],"class":["Department","Student"],multiplicity:["1..*","*"]}]},{order:["tempid1419597702615"]}],"Department-Teacher":[{tempid1419597718239:[{type:["Association",""],"class":["Department","Teacher"],multiplicity:["1..*","*"]}]},{order:["tempid1419597718239"]}]}],stateOfPage={model:"",flagCRG:0,flagDepth:0,"class":"",attribute:"",property:"",posAddAtt:"",dirAddAtt:0},componentLeftClass=getHtmlCompo("workspace_left_class"),componentLeftRelationGroup=getHtmlCompo("workspace_left_relationgroup"),componentMiddleAttributeBasic=getHtmlCompo("workspace_mid_att_basic"),componentMiddleAttribute=getHtmlCompo("workspace_mid_att"),componentMiddleRelationBasic=getHtmlCompo("workspace_mid_rel_basic"),componentMiddleRelation=getHtmlCompo("workspace_mid_rel");$(function(){fillLeft(model)}),$(function(){$('[data-toggle="tooltip"]').tooltip(),$('[data-toggle="popover"]').popover()}),$(function(){$("#stigmod-pg-workspace #stigmod-nav-left-scroll").height($(window).height()-167-10-80),$(window).resize(function(){$("#stigmod-pg-workspace #stigmod-nav-left-scroll").height($(window).height()-167-10-80)})}),$(function(){$("#stigmod-pg-workspace #stigmod-cont-right-scroll").height($(window).height()-122-80),$(window).resize(function(){$("#stigmod-pg-workspace #stigmod-cont-right-scroll").height($(window).height()-122-80)})}),$(function(){$("#stigmod-pg-workspace #stigmod-rcmd-right-scroll").height($(window).height()-122-80),$(window).resize(function(){$("#stigmod-pg-workspace #stigmod-rcmd-right-scroll").height($(window).height()-122-80)})}),$(function(){$(document).on("click","#stigmod-pg-workspace #stigmod-nav-left-scroll .list-group-item",function(){$(this).closest("#stigmod-nav-left-scroll").find(".list-group-item").removeClass("active"),$(this).addClass("active");var a=$(this).find("span:nth-child(1)");stateOfPage["class"]=a.text(),stateOfPage.flagCRG="stigmod-nav-left-class"===a.attr("class")?0:1,stateOfPage.flagDepth=0,fillMiddle(model)})}),$(function(){$(document).on("click","#stigmod-pg-workspace #stigmod-cont-right .panel",function(){var a=$(this).siblings(".panel").find(".stigmod-attr-cont-middle-title, .stigmod-rel-cont-middle-title"),b=$(this).find(".stigmod-attr-cont-middle-title, .stigmod-rel-cont-middle-title");a.attr("data-toggle","none"),b.attr("data-toggle","collapse"),$(this).siblings(".panel").removeClass("panel-primary").addClass("panel-default"),$(this).removeClass("panel-default").addClass("panel-primary")})}),$(function(){$(document).on("click","#stigmod-pg-workspace #stigmod-cont-right-scroll > .row:first-child",function(){stateOfPage["class"]=$(this).find(".stigmod-clickedit-disp").text(),stateOfPage.flagDepth=0})}),$(function(){$(document).on("click","#stigmod-pg-workspace #stigmod-cont-right .panel .panel-heading",function(){stateOfPage.attribute=$(this).parent().attr("stigmod-attrel-name"),stateOfPage.flagDepth=1})}),$(function(){$(document).on("click","#stigmod-pg-workspace #stigmod-cont-right .panel tr",function(){stateOfPage.property=$(this).find("td:first-child").text(),stateOfPage.flagDepth=2})}),$(function(){$(document).on("click","#stigmod-model-sync",function(){dump_obj(stateOfPage)})}),$(function(){$(document).on("keyup","input[type=text]",function(){checkInput($(this))})}),$(function(){$(document).on("keyup","input[type=text]",function(a){if(13===a.which){if(0!==$(this).closest(".stigmod-clickedit-root").find(".stigmod-clickedit-btn-ok").trigger("click").length)return!1;if(0!==$(this).closest(".modal").find(".btn-primary").trigger("click").length)return!1}else 27===a.which&&$(this).closest(".stigmod-clickedit-root").find(".stigmod-clickedit-btn-cancel").trigger("click")})}),$(function(){function enterEdit(a){var b=$(this).closest(".stigmod-clickedit-root"),c=b.attr("stigmod-clickedit-case"),d=b.find(".stigmod-clickedit-disp"),e=b.find(".stigmod-clickedit-edit");if(b.find(".tooltip").remove(),"title"===c){var f=d.text();e.find("input").val(f),d.css({display:"none"}),e.css({display:"table-row"}),$(this).addClass("disabled")}else{for(var g=d.length,h=0,i=0;g-1>i;++i){var j=d.eq(i).text();switch(c){case"text":e.eq(i).find("input").val(j);break;case"radio":var k=e.eq(i).find("input");"True"===j?(k.eq(0).attr({checked:""}),k.eq(1).removeAttr("checked")):"False"===j?(k.eq(1).attr({checked:""}),k.eq(0).removeAttr("checked")):(k.eq(1).removeAttr("checked"),k.eq(0).removeAttr("checked"));break;case"reltype":0===i?(e.eq(i).find("button").text(j),"Generalization"===j&&(h=1)):1===i&&(1===h?(e.eq(i).find("input").css({display:"none"}),h=0):e.eq(i).find("input").val(j));var l=$(this).closest(".stigmod-clickedit-root").next(),m=l.next(),n=m.next();m.find(".stigmod-clickedit-btn-edit").trigger("click"),l.is(":visible")&&l.find(".stigmod-clickedit-btn-edit").trigger("click"),n.is(":visible")&&n.find(".stigmod-clickedit-btn-edit").trigger("click")}}d.css({display:"none"}),e.css({display:"table"})}focusOnInputIn(e),a.preventDefault()}function submitEdit(event){var $root=$(this).closest(".stigmod-clickedit-root"),caseEdit=$root.attr("stigmod-clickedit-case"),$originalTextElem=$root.find(".stigmod-clickedit-disp"),$editComponent=$root.find(".stigmod-clickedit-edit"),$visibleInputs=$root.find("input[type=text]:visible:not([readonly])");if(checkInputs($visibleInputs))if("title"===caseEdit){var newTitle=$editComponent.find("input").val(),originalTitle=$originalTextElem.text();modifyClass(model,stateOfPage["class"],newTitle),stateOfPage["class"]=newTitle,$originalTextElem.text(newTitle);for(var nameC in model[0])for(var nameA in model[0][nameC][0])if(originalTitle===model[0][nameC][0][nameA][0].type&&(model[0][nameC][0][nameA][0].type=newTitle,nameC===stateOfPage["class"])){var $thePanel=$("#stigmod-cont-right .panel[stigmod-attrel-name="+nameA+"]");$thePanel.find("tr.stigmod-attr-prop-type > td:nth-child(2) > span:nth-child(1)").text(newTitle),refreshMiddelPanelTitle(model)}var relationGroups=getElemInModel(model,[1]);for(var nameRG in relationGroups)if(eval("var matchName = nameRG.match(/\\b"+originalTitle+"\\b/)"),null!==matchName){eval("var newNameRG = nameRG.replace(/\\b"+originalTitle+'\\b/g, "'+newTitle+'")');var nameOfBothEnds=newNameRG.split("-");nameOfBothEnds[0]>nameOfBothEnds[1]&&(newNameRG=nameOfBothEnds[1]+"-"+nameOfBothEnds[0]);for(var nameR in relationGroups[nameRG][0]){var nameClass=relationGroups[nameRG][0][nameR][0]["class"];originalTitle===nameClass[0]?nameClass[0]=newTitle:nameClass[1]=newTitle}modifyRelationGroup(model,nameRG,newNameRG)}modifyLeft(model,newTitle),$originalTextElem.css({display:"table-row"}),$editComponent.css({display:"none"}),$(this).closest(".stigmod-clickedit-root").find(".stigmod-clickedit-btn-edit").removeClass("disabled")}else{for(var num=$originalTextElem.length,propertyNameOfR="",propertyValueOfR=["",""],flagGeneralization=0,i=0;num-1>i;++i){var originalText=$originalTextElem.eq(i).text(),newText="";switch(caseEdit){case"text":newText=$editComponent.eq(i).find("input").val();break;case"radio":newText=$editComponent.eq(i).find("input:checked").parent().text();break;case"reltype":0===i?(newText=$editComponent.eq(i).find("button").text(),"Generalization"===newText&&(flagGeneralization=1)):1===i&&(1===flagGeneralization?(newText="",flagGeneralization=0):newText=$editComponent.eq(i).find("input").val());var $relrole=$(this).closest(".stigmod-clickedit-root").next(),$relclass=$relrole.next(),$relmultiplicity=$relclass.next();$relclass.find(".stigmod-clickedit-btn-ok").trigger("click"),$relrole.is(":visible")&&$relrole.find(".stigmod-clickedit-btn-ok").trigger("click"),$relmultiplicity.is(":visible")&&$relmultiplicity.find(".stigmod-clickedit-btn-ok").trigger("click")}if($originalTextElem.eq(i).text(newText),0===stateOfPage.flagCRG){var propertyName=$(this).closest(".stigmod-clickedit-root").find("td:first-child").text();addPropertyOfA(model,stateOfPage["class"],stateOfPage.attribute,[propertyName,newText]),"name"===propertyName&&(modifyAttribute(model,stateOfPage["class"],stateOfPage.attribute,newText),stateOfPage.attribute=newText,$(this).closest(".panel").attr({"stigmod-attrel-name":newText}))}else propertyNameOfR=$(this).closest(".stigmod-clickedit-root").find("td:first-child").text(),propertyValueOfR[i]=newText}1===stateOfPage.flagCRG&&addPropertyOfR(model,stateOfPage["class"],stateOfPage.attribute,[propertyNameOfR,propertyValueOfR]),$originalTextElem.css({display:"table"}),$editComponent.css({display:"none"}),refreshMiddelPanelTitle(model)}event.preventDefault()}function cancelEdit(a){var b=$(this).closest(".stigmod-clickedit-root"),c=b.attr("stigmod-clickedit-case"),d=b.find(".stigmod-clickedit-disp"),e=b.find(".stigmod-clickedit-edit");if("title"===c)d.css({display:"table-row"}),e.css({display:"none"}),$(this).closest(".stigmod-clickedit-root").find(".stigmod-clickedit-btn-edit").removeClass("disabled");else{switch(c){case"reltype":var f=$(this).closest(".stigmod-clickedit-root").next(),g=f.next(),h=g.next();g.find(".stigmod-clickedit-btn-cancel").trigger("click"),f.is(":visible")&&f.find(".stigmod-clickedit-btn-cancel").trigger("click"),h.is(":visible")&&h.find(".stigmod-clickedit-btn-cancel").trigger("click")}d.css({display:"table"}),e.css({display:"none"})}a.preventDefault()}$(document).on("click",".stigmod-clickedit-btn-edit",enterEdit),$(document).on("click",".stigmod-clickedit-btn-ok",submitEdit),$(document).on("click",".stigmod-clickedit-btn-cancel",cancelEdit)}),$(function(){}),$(function(){$(document).on("click","#btn-search",function(){$.ajax({type:"GET",url:"/components/workspace_mid_att_b",dataType:"html",success:function(a){alert(a),$("#stigmod-rcmd-right-scroll").append(a)},error:function(){alert("Sorry, The requested property could not be found.")}})})}),$(function(){$(document).on("change",'#stigmod-modal-addattribute input[type="checkbox"]',function(){var a="#stigmod-addatt-"+$(this).val();$(a).css($(this).is(":checked")?{display:"table-row"}:{display:"none"})})}),$(function(){$(document).on("change",'#stigmod-modal-addrelation input[type="checkbox"]',function(){var a="#stigmod-addrel-"+$(this).val();$(a).css($(this).is(":checked")?{display:"table-row"}:{display:"none"})})}),$(function(){$(document).on("show.bs.dropdown",".stigmod-hovershow-trig",function(){$(this).removeClass("stigmod-hovershow-trig"),$(this).find(".panel-title .dropdown-menu li").show();var a=$(this).closest(".panel").attr("stigmod-attrel-name");for(var b in model[stateOfPage.flagCRG][stateOfPage["class"]][0][a][0])$(this).closest(".panel").find(".stigmod-dropdown-"+b).hide();$(this).on("hide.bs.dropdown",function(){$(this).addClass("stigmod-hovershow-trig")})})}),$(function(){$(document).on("click",".stigmod-dropdown-addprop .dropdown-menu a",function(a){var b=$(this).text();setTimeout(function(){0===stateOfPage.flagCRG?addPropertyOfA(model,stateOfPage["class"],stateOfPage.attribute,[b,""]):addPropertyOfR(model,stateOfPage["class"],stateOfPage.attribute,[b,["",""]])},10);var c=$(this).closest(".panel").find(".stigmod-attr-prop-"+b+", .stigmod-rel-prop-"+b);c.show(),c.find(".stigmod-clickedit-btn-edit").trigger("click"),c.find("input[type=radio][value=True]").prop("checked",!0),$(this).closest(".panel").find(".panel-collapse").collapse("show"),a.preventDefault()})}),$(function(){$(document).on("click","#stigmod-dropdown-reltype-modal a",function(a){var b=$(this).text(),c=$(this).closest(".stigmod-table-addrelation"),d=$(this).closest("#stigmod-dropdown-reltype-modal").find("button"),e=c.find("#stigmod-addrel-type").find(".stigmod-input"),f=c.find("#stigmod-addrel-role").find(".stigmod-input"),g=c.find("#stigmod-addrel-multiplicity").find(".stigmod-input");switch(b){case"Generalization":d.text("Generalization"),e.css({display:"none"}).tooltip("destroy"),f.eq(0).val("father").tooltip("destroy"),f.eq(1).val("child").tooltip("destroy"),g.eq(0).attr({disabled:""}).val("1").tooltip("destroy"),g.eq(1).attr({disabled:""}).val("1").tooltip("destroy");break;case"Composition":d.text("Composition"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("whole").tooltip("destroy"),f.eq(1).val("part").tooltip("destroy"),g.eq(0).attr({disabled:""}).val("1").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy");break;case"Aggregation":d.text("Aggregation"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("owner").tooltip("destroy"),f.eq(1).val("ownee").tooltip("destroy"),g.eq(0).removeAttr("disabled").val("").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy");break;case"Association":d.text("Association"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("").tooltip("destroy"),f.eq(1).val("").tooltip("destroy"),g.eq(0).removeAttr("disabled").val("").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy")}a.preventDefault()})}),$(function(){$(document).on("click","#stigmod-addrel-class .glyphicon-transfer",function(a){var b=$(this).closest("#stigmod-addrel-class").find(".stigmod-input"),c=b.first().val();b.first().val(b.last().val()),b.last().val(c),a.preventDefault()})}),$(function(){$(document).on("click","#stigmod-dropdown-reltype a",function(a){var b=$(this).text(),c=$(this).closest(".stigmod-table-relation"),d=$(this).closest("#stigmod-dropdown-reltype").find("button"),e=c.find(".stigmod-rel-prop-type").find(".stigmod-input"),f=c.find(".stigmod-rel-prop-role").find(".stigmod-input"),g=c.find(".stigmod-rel-prop-multiplicity").find(".stigmod-input");switch(b){case"Generalization":d.text("Generalization"),e.css({display:"none"}).tooltip("destroy"),f.eq(0).val("father").tooltip("destroy"),f.eq(1).val("child").tooltip("destroy"),g.eq(0).attr({disabled:""}).val("1").tooltip("destroy"),g.eq(1).attr({disabled:""}).val("1").tooltip("destroy");break;case"Composition":d.text("Composition"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("whole").tooltip("destroy"),f.eq(1).val("part").tooltip("destroy"),g.eq(0).attr({disabled:""}).val("1").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy");break;case"Aggregation":d.text("Aggregation"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("owner").tooltip("destroy"),f.eq(1).val("ownee").tooltip("destroy"),g.eq(0).removeAttr("disabled").val("").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy");break;case"Association":d.text("Association"),e.css({display:"block"}).tooltip("destroy"),f.eq(0).val("").tooltip("destroy"),f.eq(1).val("").tooltip("destroy"),g.eq(0).removeAttr("disabled").val("").tooltip("destroy"),g.eq(1).removeAttr("disabled").val("").tooltip("destroy")}a.preventDefault()})}),$(function(){$(document).on("click",".stigmod-rel-prop-class .glyphicon-transfer",function(a){var b=$(this).closest(".stigmod-rel-prop-class").find(".stigmod-input"),c=b.first().val();b.first().val(b.last().val()),b.last().val(c),a.preventDefault()})}),$(function(){$(document).on("click","#stigmod-btn-addclass",function(){var a=$(this).closest("#stigmod-modal-addclass").find("input[type=text]:not([readonly])");if(checkInput(a)){var b=a.val();addClass(model,b),stateOfPage.flagCRG=0,stateOfPage.flagDepth=0,stateOfPage["class"]=b,modifyLeftAndJump(model,b),$(this).next().trigger("click")}})}),$(function(){function a(a,b){return elemExists(1,b)?(a.tooltip("destroy"),a.tooltip({animation:!1,title:"Relation group already exists.",placement:"top",trigger:"manual"}),a.tooltip("show"),!1):!0}$(document).on("click","#stigmod-btn-addrelationgroup",function(){var b=$(this).closest("#stigmod-modal-addrelationgroup").find("input[type=text]:not([readonly])"),c=b.eq(0).val(),d=b.eq(1).val(),e=d>c?c+"-"+d:d+"-"+c;checkInputs(b)&&a($(this).closest(".modal-footer"),e)&&(addRelationGroup(model,e),stateOfPage.flagCRG=1,stateOfPage.flagDepth=0,stateOfPage["class"]=e,modifyLeftAndJump(model,e),$(this).next().trigger("click"))})}),$(function(){$(document).on("click",".stigmod-addattrel-trig",function(){var a=$(this);setTimeout(function(){a.hasClass("stigmod-addattrel-last")?(stateOfPage.posAddAtt="@",stateOfPage.dirAddAtt=0):(stateOfPage.posAddAtt=a.closest(".panel").attr("stigmod-attrel-name"),stateOfPage.dirAddAtt=a.hasClass("stigmod-addattrel-above")?0:1),0===stateOfPage.flagCRG?$("#stigmod-modal-addattribute").modal("show"):$("#stigmod-modal-addrelation").modal("show")},10)})}),$(function(){$(document).on("click","#stigmod-btn-addattribute",function(){var a=$(this).closest("#stigmod-modal-addattribute").find("input[type=text]:visible:not([readonly])");if(checkInputs(a)){var b=$(this).closest("#stigmod-modal-addattribute").find("#stigmod-addatt-name input").val();addAttribute(model,stateOfPage["class"],b);var c=$(this).closest("#stigmod-modal-addattribute").find("tr:visible");c.each(function(){var a=$(this).attr("stigmod-addatt-case"),c=$(this).find("td:first-child").text(),d=null;switch(a){case"text":d=$(this).find("input").val();break;case"radio":d=$(this).find("input:checked").parent().text()}addPropertyOfA(model,stateOfPage["class"],b,[c,d])});var d=model[stateOfPage.flagCRG][stateOfPage["class"]][1].order;"@"===stateOfPage.posAddAtt?d.push(b):d.splice(d.indexOf(stateOfPage.posAddAtt)+stateOfPage.dirAddAtt,0,b),insertMiddle(model,b),$(this).next().trigger("click")}})}),$(function(){function a(a){return""===a.text()?(a.tooltip("destroy"),a.tooltip({animation:!1,title:"Relation type can not be void.",placement:"top",trigger:"manual"}),a.tooltip("show"),!1):!0}$(document).on("click","#stigmod-btn-addrelation",function(){var b=$(this).closest("#stigmod-modal-addrelation").find("input[type=text]:visible:not([readonly])"),c=$(this).closest("#stigmod-modal-addrelation").find("#stigmod-dropdown-reltype-modal > button");if(checkInputs(b)&&a(c)){var d="tempid"+Date.now();addRelation(model,stateOfPage["class"],d);var e=$(this).closest("#stigmod-modal-addrelation").find("tr:visible");e.each(function(){var a=$(this).attr("stigmod-addrel-case"),b=$(this).find("td:first-child").text(),c=null,e=null;if("type"===b){var f=$(this).find("button").text(),g=$(this).find("input").val();addPropertyOfR(model,stateOfPage["class"],d,[b,[f,g]])}else{switch(a){case"text":c=$(this).find("input").first().val(),e=$(this).find("input").last().val();break;case"radio":c=$(this).find("input:checked").first().parent().text(),e=$(this).find("input:checked").last().parent().text()}addPropertyOfR(model,stateOfPage["class"],d,[b,[c,e]])}}),"@"===stateOfPage.posAddAtt?model[stateOfPage.flagCRG][stateOfPage["class"]][1].order.push(d):model[stateOfPage.flagCRG][stateOfPage["class"]][1].order.splice(model[stateOfPage.flagCRG][stateOfPage["class"]][1].order.indexOf(stateOfPage.posAddAtt)+stateOfPage.dirAddAtt,0,d),insertMiddle(model,d),$(this).next().trigger("click")}})}),$(function(){$(document).on("click",".fa-arrow-up",function(){var a=$(this).closest(".panel"),b=a.prev();if(b.hasClass("panel")){var c=a.attr("stigmod-attrel-name"),d=model[stateOfPage.flagCRG][stateOfPage["class"]][1].order,e=d.indexOf(c);d.splice(e,1),d.splice(e-1,0,c),stateOfPage.posAddAtt=b.attr("stigmod-attrel-name"),stateOfPage.dirAddAtt=0,insertMiddle(model,c,!0),a.remove()}}),$(document).on("click",".fa-arrow-down",function(){var a=$(this).closest(".panel"),b=a.next();if(b.hasClass("panel")){var c=a.attr("stigmod-attrel-name"),d=model[stateOfPage.flagCRG][stateOfPage["class"]][1].order,e=d.indexOf(c);d.splice(e,1),d.splice(e+1,0,c),stateOfPage.posAddAtt=b.attr("stigmod-attrel-name"),stateOfPage.dirAddAtt=1,insertMiddle(model,c,!0),a.remove()}})}),$(function(){$(document).on("click",".fa-remove, .glyphicon-trash, .stigmod-remove-trig",function(){setTimeout(function(){$("#stigmod-modal-remove").modal("show")},10)})}),$(function(){$(document).on("click","#stigmod-btn-remove",function(){switch(stateOfPage.flagDepth){case 0:if(removeElemInModel(model,[stateOfPage.flagCRG],stateOfPage["class"]),0===stateOfPage.flagCRG){var relationGroups=getElemInModel(model,[1]);
for(var nameRG in relationGroups)eval("var matchName = nameRG.match(/\\b"+stateOfPage["class"]+"\\b/)"),null!==matchName&&removeElemInModel(model,[1],nameRG)}fillLeft(model),fillMiddleBlank();break;case 1:removeElemInModel(model,[0,stateOfPage["class"],stateOfPage.flagCRG],stateOfPage.attribute);var order=model[stateOfPage.flagCRG][stateOfPage["class"]][1].order;order.splice(order.indexOf(stateOfPage.attribute),1),removeMiddle(model,stateOfPage.attribute);break;case 2:removeElemInModel(model,[0,stateOfPage.attribute,0,stateOfPage["class"],stateOfPage.flagCRG],stateOfPage.property);for(var prop=[".stigmod-attr-prop-",".stigmod-rel-prop-"],$root=$("#stigmod-cont-right .panel[stigmod-attrel-name="+stateOfPage.attribute+"] "+prop[stateOfPage.flagCRG]+stateOfPage.property),$text=$root.find(".stigmod-clickedit-disp"),num=$text.length,i=0;num-1>i;++i)$text.eq(i).text("");$root.hide(),refreshMiddelPanelTitle(model)}$(this).next().trigger("click")})}),$(function(){var a="#stigmod-modal-addclass, #stigmod-modal-addrelationgroup, #stigmod-modal-addattribute, #stigmod-modal-addrelation";$(document).on("show.bs.modal",a,function(){$(this).find(".tooltip").remove()}),$(document).on("shown.bs.modal",a,function(){focusOnInputIn($(this))}),$(document).on("show.bs.modal","#stigmod-modal-addclass",function(){$(this).find("input").val("")}),$(document).on("show.bs.modal","#stigmod-modal-addrelationgroup",function(){$(this).find("input").val("")}),$(document).on("show.bs.modal","#stigmod-modal-addattribute",function(){$(this).find("input[type=text]").val(""),$(this).find("input[type=radio][value=True]").prop("checked",!0),$(this).find("input[type=checkbox]").removeAttr("checked"),$(this).find("input[value=type]").prop("checked",!0),$(this).find("tr").hide(),$(this).find("tr:nth-child(1)").css("display","table-row"),$(this).find("tr:nth-child(2)").css("display","table-row")}),$(document).on("show.bs.modal","#stigmod-modal-addrelation",function(){$(this).find("input[type=text]").val(""),$(this).find("input[type=radio][value=True]").prop("checked",!0),$(this).find("input[type=checkbox]").removeAttr("checked"),$(this).find("input[value=role]").prop("checked",!0),$(this).find("input[value=multiplicity]").prop("checked",!0),$(this).find("tr").hide(),$(this).find("tr:nth-child(1) button").text(""),$(this).find("tr:nth-child(2) input").removeAttr("disabled"),$(this).find("tr:nth-child(4) input").removeAttr("disabled");var a=stateOfPage["class"].split("-");$(this).find("tr:nth-child(3) > td:nth-child(2) > input").val(a[0]),$(this).find("tr:nth-child(3) > td:nth-child(3) > input").val(a[1]),$(this).find("tr:nth-child(1)").css("display","table-row"),$(this).find("tr:nth-child(2)").css("display","table-row"),$(this).find("tr:nth-child(3)").css("display","table-row"),$(this).find("tr:nth-child(4)").css("display","table-row")}),$(document).on("show.bs.modal","#stigmod-modal-remove",function(){var a=new Array;a[0]=new Array("CLASS","ATTRIBUTE","PROPERTY"),a[1]=new Array("RELATION GROUP","RELATION","PROPERTY");var b=[stateOfPage["class"],stateOfPage.attribute,stateOfPage.property];$(this).find(".stigmod-modal-remove-type").text(a[stateOfPage.flagCRG][stateOfPage.flagDepth]),$(this).find(".stigmod-modal-remove-name").text(b[stateOfPage.flagDepth])})}),+function(){function a(a){return a.weight||(a.weight=1),3*a.weight+5}function b(a){return a.weight||(a.weight=1),3*a.weight+10}function c(){d3.select(this).select("circle").transition().duration(500).ease("bounce").attr("r",function(a){return b(a)}).attr("stroke","#ccc").attr("stroke-width",2.5)}function d(){d3.select(this).select("circle").transition().duration(500).attr("r",function(b){return a(b)}).attr("stroke-width",0)}var e=500,f=400,g={nodes:[{name:"Student",property:[{name:"StudentName"},{name:"StudentID"},{name:"Password"}]},{name:"Course",property:[{name:"CourseName"},{name:"CourseID"},{name:"CourseCategory"},{name:"Credit"},{name:"Place"},{name:"Time"},{name:"Teacher"}]},{name:"CourseList",property:[{name:"StudentID"},{name:"CourseID"}]},{name:"SelectedCourses",property:[{name:"Major"},{name:"SpecialDate"},{name:"Calendar"}]},{name:"CourseChart",property:[{name:"CourseID"},{name:"CourseName"},{name:"Teacher"},{name:"StudentType"},{name:"CourseType"},{name:"ClassNumber"}]},{name:"CourseManager",property:[{name:"ManagerName"},{name:"WorkID"},{name:"Password"}]}],edges:[{source:0,target:1},{source:0,target:2},{source:0,target:3},{source:1,target:3},{source:2,target:3},{source:2,target:5},{source:3,target:5},{source:4,target:5}]},h=d3.select("#stigmod-d3view-left").append("svg").attr("width",e).attr("height",f),i=d3.layout.force().nodes(g.nodes).links(g.edges).size([e,f]).linkDistance(100).charge([-400]).start(),j=d3.scale.category10(),k=h.selectAll(".link").data(g.edges).enter().append("g").attr("class","link");k.append("line").style("stroke","#ccc").style("stroke-width",1);var l=h.selectAll(".node").data(g.nodes).enter().append("g").attr("class","node").on("mouseover",c).on("mouseout",d).on("click",function(a){d3.select(".property").remove(),d3.select("#stigmod-d3view-right").append("div").attr("class","property"),d3.select(".property").append("br"),d3.select(".property").append("p").attr("style","padding-left:10%;font-weight:bold").text("Class:"),d3.select(".property").append("p").attr("style","padding-left:20%").text(a.name),d3.select(".property").append("br"),d3.select(".property").append("p").attr("style","padding-left:10%;font-weight:bold").text("Properties:"),a.property.forEach(function(a){d3.select(".property").append("p").attr("style","padding-left:20%").text(a.name)})}).call(i.drag);l.append("circle").attr("r",function(b){return a(b)}).style("fill",function(a,b){return j(b)}),l.append("title").text(function(a){return a.name}),l.append("text").text(function(a){return a.name}),i.on("tick",function(){k.selectAll("line").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),l.selectAll("circle").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}),k.selectAll("text").attr("x",function(a){return(a.source.x+a.target.x)/2}).attr("y",function(a){return(a.source.y+a.target.y)/2}),l.selectAll("text").attr("x",function(a){return a.x+17}).attr("y",function(a){return a.y+5})})}()});